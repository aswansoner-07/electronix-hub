{% extends 'headerfooter.html' %}

{% block css %}
    .userProfile {
        margin-top: 150px;
        margin-left: 50px;
        width: 90%;
        border: none;
        border-radius: 6px;
        background-color: rgb(238, 246, 255);
    }

    #profile-photo {
        border-radius: 50%;
        width: 150px;
        height: 150px;
        object-fit: cover;
    }

    #file-input {
        display: none;
    }

    #save-button {
        margin-top: 0px;
        margin-left: 60px;
        padding: 8px 12px;
        width: 90px;
        background-color: #007bff;
        color: #fff;
        border: none;
        cursor: pointer;
        border-radius: 4px;
    }

    #save-button:hover {
        background-color: #9d09e2;
    }

    #upload-label {
        margin-left: 130px;
    }

    table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 100%;
    }

    td, th {
        border: 1px solid #dddddd;
        text-align: center;
        padding: 8px;
    }

    tr:nth-child(even) {
        background-color: #dddddd;
    }

    #popup {
        display: none;
        color: white;
        border: none;
        border-radius: 5px;
        background-color: #0e91e3;
        padding: 7px;
        width: 250px;
    }
{% endblock %}

{% block html %}
    <div class="userProfile">
        <h1 style="margin-top: 30px; text-align: center; color: #058dfd;">Account Details</h1><br><br>
        <center><span id="popup">Profile picture updated !!!</span></center>
        <div style="display: flex; margin: 20px; padding: 20px; justify-content: space-around; font-size: 19px;">
            <div>
                <img src="static/pic/{{user_data[0][1]}}.jpg" id="profile-photo" style="height: 150px; width: 150px; background: #fbf6f6; margin-left: 20px; object-fit: cover; border-radius: 50%;" onerror="loadBackupImage()" alt="Profile Photo">
                <br>
                <input type="file" id="file-input" accept="image/*">
                <br>
                <label for="file-input" id="upload-label"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQVGFl6Vx5OisNUWYMPT5jpEVkTvPWFZQ4lyzYbDH4m7V5Zwzp-5uK68uQtaVu83UN9S_E&usqp=CAU" height="30px" width="30px" style="mix-blend-mode: multiply; margin-left: -40px;" alt="edit profile photo"></label>
                <button id="save-button" onclick="uploadImage()">Save</button><br>
            </div>
            <p style="margin-top: 20px; font-family:'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; line-height: 130%;">
                Username: {{ user_data[0][1] }} <br>
                Mobileno.: {{ user_data[0][2] }} <br>
                Email: {{ user_data[0][3] }} <br>
                Address: {{ user_data[0][5]}} {{user_data[0][7]}} {{user_data[0][8]}}
            </p>
        </div><br><br>
        <div>
            <h2 style="margin-left: 40%;"> History of Products </h2><br><br>
            <table>
                <tr>
                    <th>Product Name</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Date of order</th>
                    <th>Status</th>
                </tr>
                {% for item in order_data %}
                    <tr>
                        <td>{{ item[0][0] }}</td>
                        <td>{{ item[0][1] }}</td>
                        <td>1</td>
                        <td>{{ item[2] }}</td>
                        <td>{{ item[3] }}</td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div><br><br>
    <script>
        document.getElementById('file-input').addEventListener('change', function (event) {
            const preview = document.getElementById('profile-photo');
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = function () {
                preview.src = reader.result;
            };

            if (file) {
                reader.readAsDataURL(file);
            }

        });

        function uploadImage() {
            const preview = document.getElementById('profile-photo');
            const imageBase64 = preview.src.split(',')[1];

            fetch('/upload', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ image: imageBase64 }),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Response from server:', data);
                // For demonstration purposes, show/hide a popup message
                const popup = document.getElementById("popup");
                popup.style.display = "block";
                setTimeout(() => {
                    popup.style.display = "none";
                }, 5000);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
        function loadBackupImage() {
            document.getElementById('profile-photo').src = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTQJDEnnVNYD3wOk0PIywPT-2m4UETU7lhOSFBO2HywWPvrH7-g45Eh4Rq9F9WxZTYONKU&usqp=CAU';
        }
    </script>
{% endblock %}
